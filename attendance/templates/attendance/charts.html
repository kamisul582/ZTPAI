
{% extends 'shared_layout/base.html' %}

{%block contents%}




{% load static %}
{% if user.is_company == 1 and user.is_worker == 0%}
<h2>{{ company.name }} Company Profile </h2>
<p><strong>User ID:</strong> {{ user.id }}</p>
<p><strong>Email:</strong> {{ user.email }}</p>
<h1>Some Line Charts loaded in Ajax!</h1>


        
        <script type="text/javascript" src="http://code.jquery.com/jquery-1.10.0.min.js"></script>
        <script type="text/javascript" src="{% static 'js/Chart.min.js' %}"></script>
        <script type="text/javascript">
            $(document).ready(function() {
                // Initialize the chart
                var ctx = $("#myChart").get(0).getContext("2d");
                var myChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: [],
                        datasets: []
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
        
                // Function to fetch chart data based on selected user_id
                function fetchChartData(userId) {
                    var chartUrl = '{% url "attendance:line_chart_json" %}?user_id=' + userId;
                    $.get(chartUrl, function(data) {
                        // Update the chart data
                        myChart.data = data;
                        myChart.update();
                    });
                }
        
                // Populate dropdown with worker information
                var dropdown = $('#user_id_dropdown');
                dropdown.empty();
                dropdown.append('<option selected="true" disabled>Select Worker</option>');
                dropdown.prop('selectedIndex', 0);
                var url = '{% url "attendance:get_user_ids" %}';
                $.getJSON(url, function(data) {
                    $.each(data.workers, function(key, worker) {
                        var optionText = worker.firstname ? worker.firstname + ' ' + worker.lastname + ' (ID: ' + worker.user_id + ')' : 'ID: ' + worker.user_id;
                        dropdown.append($('<option></option>').attr('value', worker.user_id).text(optionText));
                    })
                }).fail(function() {
                    console.error('Failed to fetch worker information.');
                });
        
                // Event listener for dropdown change
                dropdown.on('change', function() {
                    var userId = $(this).val();
                    fetchChartData(userId);
                });
            });
        
            var xAxisLabelMinWidth = 15;
            function fitChart(){
                var chartCanvas = document.getElementById('chart');
                var maxWidth = chartCanvas.parentElement.parentElement.clientWidth;
                var width = Math.max(myChart.data.labels.length * xAxisLabelMinWidth, maxWidth);
        
                chartCanvas.parentElement.style.width = width +'px';
            }
        </script>
        
        <script type="text/javascript">
            var xAxisLabelMinWidth = 15;
            function fitChart(){
                var chartCanvas = document.getElementById('chart');
                var maxWidth = chartCanvas.parentElement.parentElement.clientWidth;
                var width = Math.max(mayChart.data.labels.length * xAxisLabelMinWidth, maxWidth);

                chartCanvas.parentElement.style.width = width +'px';
}
        </script>
        <select id="user_id_dropdown"></select>
        <div class="chartWrapper">
            <div class="chartContainer">
                <canvas id="myChart"></canvas>
            </div>
        </div>
{% endif %}


{%endblock contents%}
